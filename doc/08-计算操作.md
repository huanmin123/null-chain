# 计算操作

本文档介绍数值计算操作，包括加减乘除、取绝对值、取最大值等。

## 创建计算链

### 从数值创建

```java
// 从 Number 类型创建
BigDecimal result = Null.ofCalc(100)
    .add(50)
    .multiply(2)
    .orElse(BigDecimal.ZERO);

// 从 NullChain 创建
BigDecimal result = Null.ofCalc(Null.of(100))
    .add(50)
    .orElse(BigDecimal.ZERO);
```

## 基本运算

### add() - 加法

```java
// 基本加法
BigDecimal result = Null.ofCalc(100)
    .add(50)
    .orElse(BigDecimal.ZERO);  // 结果: 150

// 带默认值的加法
BigDecimal result = Null.ofCalc((Integer) null)
    .add(50, 0)  // 如果当前值为null，使用0作为默认值
    .orElse(BigDecimal.ZERO);
```

### sub() - 减法

```java
// 基本减法
BigDecimal result = Null.ofCalc(100)
    .sub(50)
    .orElse(BigDecimal.ZERO);  // 结果: 50

// 带默认值的减法
BigDecimal result = Null.ofCalc((Integer) null)
    .sub(50, 0)
    .orElse(BigDecimal.ZERO);
```

### mul() - 乘法

```java
// 基本乘法
BigDecimal result = Null.ofCalc(100)
    .mul(2)
    .orElse(BigDecimal.ZERO);  // 结果: 200

// 带默认值的乘法
BigDecimal result = Null.ofCalc((Integer) null)
    .mul(2, 1)
    .orElse(BigDecimal.ZERO);
```

### div() - 除法

```java
// 基本除法
BigDecimal result = Null.ofCalc(100)
    .div(2)
    .orElse(BigDecimal.ZERO);  // 结果: 50

// 带默认值的除法
BigDecimal result = Null.ofCalc((Integer) null)
    .div(2, 1)
    .orElse(BigDecimal.ZERO);
```

## 数值处理

### negate() - 取反

```java
// 取反运算
BigDecimal result = Null.ofCalc(100)
    .negate()
    .orElse(BigDecimal.ZERO);  // 结果: -100
```

### abs() - 取绝对值

```java
// 取绝对值
BigDecimal result = Null.ofCalc(-100)
    .abs()
    .orElse(BigDecimal.ZERO);  // 结果: 100
```

### max() - 取最大值

```java
// 取最大值
BigDecimal result = Null.ofCalc(100)
    .max(new BigDecimal(150))
    .orElse(BigDecimal.ZERO);  // 结果: 150
```

### min() - 取最小值

```java
// 取最小值
BigDecimal result = Null.ofCalc(100)
    .min(new BigDecimal(50))
    .orElse(BigDecimal.ZERO);  // 结果: 50
```

## 高级运算

### pow() - 幂运算

```java
// 平方运算
BigDecimal result = Null.ofCalc(10)
    .pow(2)
    .orElse(BigDecimal.ZERO);  // 结果: 100

// 立方运算
BigDecimal result = Null.ofCalc(5)
    .pow(3)
    .orElse(BigDecimal.ZERO);  // 结果: 125
```

### round() - 舍入运算

```java
// 默认舍入（保留2位小数，四舍五入）
BigDecimal result = Null.ofCalc(100.456)
    .round()
    .orElse(BigDecimal.ZERO);  // 结果: 100.46

// 指定精度和舍入模式
BigDecimal result = Null.ofCalc(100.456)
    .round(1, RoundingMode.HALF_UP)  // 保留1位小数，四舍五入
    .orElse(BigDecimal.ZERO);  // 结果: 100.5
```

### map() - 数值映射

```java
// 将 BigDecimal 映射为其他数值类型
Integer result = Null.ofCalc(100.5)
    .round()
    .map(BigDecimal::intValue)
    .orElse(0);  // 结果: 101

// 映射为 Long
Long result = Null.ofCalc(100.5)
    .round()
    .map(BigDecimal::longValue)
    .orElse(0L);
```

## 完整示例

```java
import com.gitee.huanminabc.nullchain.Null;
import java.math.BigDecimal;
import java.math.RoundingMode;

public class CalculateExample {
    
    public void basicOperations() {
        // 复杂计算：100 + 50 * 2 - 30
        BigDecimal result = Null.ofCalc(100)
            .add(50)
            .mul(2)
            .sub(30)
            .orElse(BigDecimal.ZERO);
        // 结果: 170
    }
    
    public void withDefaultValue() {
        // 处理可能为null的值
        Integer value = getValue();  // 可能返回null
        BigDecimal result = Null.ofCalc(value)
            .add(50, 0)  // 如果value为null，使用0作为默认值
            .mul(2, 1)
            .orElse(BigDecimal.ZERO);
    }
    
    public void precisionControl() {
        // 精确计算并控制精度
        BigDecimal result = Null.ofCalc(100.456789)
            .add(50.123456)
            .round(2, RoundingMode.HALF_UP)  // 保留2位小数
            .orElse(BigDecimal.ZERO);
    }
    
    public void complexCalculation() {
        // 复杂计算：计算圆的面积 (π * r²)
        double radius = 5.0;
        BigDecimal area = Null.ofCalc(radius)
            .pow(2)
            .mul(Math.PI)
            .round(2, RoundingMode.HALF_UP)
            .orElse(BigDecimal.ZERO);
    }
    
    public void typeConversion() {
        // 计算并转换为整数
        Integer result = Null.ofCalc(100.456)
            .add(50.789)
            .round()
            .map(BigDecimal::intValue)
            .orElse(0);
    }
}
```

## 技术特点

### 精度保证

- **底层实现**：使用 `BigDecimal` 确保计算精度
- **参数处理**：方法入参取值都是 `doubleValue()`，避免精度丢失
- **计算过程**：整个计算过程都使用 `BigDecimal`
- **类型要求**：要求实现 `Number` 的类必须实现 `doubleValue()` 方法并返回正确的值

### 空值安全

- 所有操作都是空值安全的
- 支持为 null 值提供默认值
- 遇到 null 值会优雅处理，不会抛出异常

## 注意事项

1. **精度问题**：使用 `BigDecimal` 确保计算精度，避免浮点数精度问题
2. **默认值**：可以为 null 值提供默认值，确保计算能够继续
3. **类型转换**：使用 `map()` 方法可以将 `BigDecimal` 转换为其他数值类型
4. **舍入模式**：根据业务需求选择合适的舍入模式

